<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Module4</title>
<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="assets/css/styles.css">

<style>
#card-style {
	box-shadow: 3px 3px #e0e0e0;
}
</style>


</head>

<body onload="requestContent()">
	<div>
		<div class="container">
			<div class="row" style="padding-top: 12px; padding-bottom: 6px;">
				<div class="col-md-12" style="padding: 0px;">
					<div class="card" id="card-style">
						<div class="card-body">
							<div class="col-md-12 d-flex align-items-center">
								<img src="assets/img/OV.png"
									style="height: 70px; margin-right: 12px;"><input
									id="searchid" type="text" placeholder="Employee Number"
									style="margin: 6px;"><input id="searchname" type="text"
									placeholder="Full Name" style="margin: 6px;">
								<div class="dropdown d-inline-flex">
									<button id="statusButton"
										class="btn btn-primary dropdown-toggle" data-toggle="dropdown"
										aria-expanded="false" type="button"
										style="margin-right: 6px; margin-left: 6px;">Status</button>
									<div id="statusDropdown" class="dropdown-menu" role="menu">
										<a id="statusA" onclick=statusFilterA() class="dropdown-item"
											role="presentation" value="1">Active</a><a id="statusI"
											onclick=statusFilterI() class="dropdown-item"
											role="presentation" value="2">Not Active</a><a id="statusH"
											onclick=statusFilterH() class="dropdown-item"
											role="presentation" value="3">Not Active Yet</a>
									</div>
								</div>
								<button onclick=searchupdate() class="btn btn-primary"
									type="button" style="margin-left: 6px;">Search</button>
								<div class="btn-group ml-auto" role="group">
									<div class="dropdown d-inline-flex" style="margin: 6px;">
										<button id="officeButtton"
											class="btn btn-primary dropdown-toggle"
											data-toggle="dropdown" aria-expanded="false" type="button"
											style="margin-right: 6px; margin-left: 6px;">Office</button>
										<div id="officeDropdown" class="dropdown-menu" role="menu">
											<a class="dropdown-item" role="presentation" href="#">Amersfoort</a><a
												class="dropdown-item" role="presentation" href="#">Apeldoorn</a><a
												class="dropdown-item" role="presentation" href="#">Den
												Haag</a><a class="dropdown-item" role="presentation" href="#">MÃ¼nster</a><a
												class="dropdown-item" role="presentation" href="#">Oldenzaal</a>
										</div>
									</div>
									<form id="upload" enctype="multipart/form-data" method="post"
										action="./OV/main/import">
										<button class="btn btn-primary" type="button"
											onclick="openFileDialog();" style="margin: 6px;">Import</button>
										<input type="file" id="fileLoader"
											onchange="this.form.submit()" name="files" title="Load File" />
									</form>
									<button class="btn btn-primary" type="button"
										onclick="location.href='./OV/main/export.csv'"
										style="margin: 6px;">Export</button>
									<button onclick=logout() class="btn btn-primary" type="button"
										style="margin-left: 6px;">Log Out</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row" style="padding-top: 6px;">
				<div class="col-md-12">
					<div class="card">
						<div class="card-body" style="padding: 0px;">
							<div class="table-responsive">
								<table class="table">
									<thead>
										<tr>
											<td>Employee Number</td>
											<td>Full Name</td>
											<td>Status</td>
										</tr>
									</thead>
									<tbody id="EmployeeList">
										<tr>
											<td></td>
											<td></td>
											<td></td>
										</tr>
										<tr>
											<td></td>
											<td></td>
											<td></td>
										</tr>
									</tbody>
								</table>
							</div>
							<div class="modal fade" role="dialog" tabindex="-1" id="empInfo">
								<div class="modal-dialog" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h4 id=infotitle class="modal-title"></h4>
											<button type="button" class="close" data-dismiss="modal"
												aria-label="Close">
												<span aria-hidden="true">x</span>
											</button>
										</div>
										<div class="modal-body" style="padding: 0;">
											<div class="table-responsive">
												<table class="table">
													<thead>
														<tr>
															<th>Payrate</th>
															<th>From</th>
															<th>Until</th>
														</tr>
													</thead>
													<tbody id=infotable>
														<tr>
															<td></td>
															<td></td>
															<td></td>
														</tr>
														<tr>
															<td></td>
															<td></td>
															<td></td>
														</tr>
													</tbody>
												</table>
											</div>
										</div>
										<div class="modal-footer">
											<button class="btn btn-light" type="button"
												data-dismiss="modal">Close</button>
											<button class="btn btn-primary" type="button">Save</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/bootstrap/js/bootstrap.min.js"></script>
	<script src="assets/js/main.js"></script>
	<script>
		var list = [];
		var info = [];
		var dropdownitems = [];
		var A;
		var I;
		var H;
		var xhr = new XMLHttpRequest();
		xhr.onload = function() {
			if (xhr.readyState == 4 && xhr.status == 200) {
				console.log(this.responseText);
				if (this.responseText == "0") {
					window.location.replace(".");
				}
				try {
					var temp = JSON.parse(this.responseText);
					if (temp.length > 0) {
						if (temp[0].hasOwnProperty("cost")) {
							info = temp;
							updateinfo();
						} else if (temp[0].hasOwnProperty("status")) {
							list = temp;
							updatelist();
						} else {
							dropdownitems = temp;
							addDropdown();
						}
					}
				} catch (e) {
					console.log("caught exception : " + e);
				}
			}
		}

		function updatelist() {
			var body = document.getElementById('EmployeeList');
			body.innerHTML = "";

			for (var i = 0; i < list.length; i++) {

				var ver = document.createElement("tr");

				var id = document.createElement("td");
				var ptxt = document.createTextNode(list[i].id);
				id.appendChild(ptxt);
				ver.appendChild(id);

				var name = document.createElement("td");
				var ntxt = document.createTextNode(list[i].name);
				name.appendChild(ntxt);
				ver.appendChild(name);

				var active = document.createElement("td");
				var atxt = document.createTextNode(list[i].status);
				active.appendChild(atxt);
				ver.appendChild(active);
				ver.setAttribute('onclick', "getId(" + list[i].id + ", \""
						+ list[i].name + "\")");
				body.appendChild(ver);
			}

		}

		function openFileDialog() {
			$("#fileLoader").click();
		}

		function searchupdate() {
			let crdnr = document.getElementById("searchid").value;
			let fullname = document.getElementById("searchname").value;
			if (crdnr != "" && fullname != "") {
				xhr.open("GET", "./OV/main/search/" + crdnr + "/" + fullname);
			} else if (crdnr == "" && fullname != "") {
				xhr.open("GET", "./OV/main/search/" + -1 + "/" + fullname);
			} else if (crdnr != "" && fullname == "") {
				xhr.open("GET", "./OV/main/search/" + crdnr + "/" + -1);
			}
			xhr.send();
		}

		function updateinfo() {
			var body = document.getElementById('infotable');
			body.innerHTML = "";

			for (var i = 0; i < info.length; i++) {

				var ver = document.createElement("tr");

				var id = document.createElement("td");
				var ptxt = document.createTextNode(info[i].cost);
				id.appendChild(ptxt);
				ver.appendChild(id);

				var name = document.createElement("td");
				var ntxt = document.createTextNode(info[i].startDate);
				name.appendChild(ntxt);
				ver.appendChild(name);

				var active = document.createElement("td");
				var atxt = document.createTextNode(info[i].endDate);
				active.appendChild(atxt);
				ver.appendChild(active);
				body.appendChild(ver);
			}
		}

		function addDropdown() {
			dropdown = document.getElementById("officeDropdown")
			dropdown.innerHTML = "";
			for (var i = 0; i < dropdownitems.length; i++) {
				dropdown.innerHTML += "<a class=\"dropdown-item\" role=\"presentation\" href=\"#\">"
						+ dropdownitems[i] + "</a>";
			}

		}

		function newPayrate() {

		}

		function statusFilterA() {
			let status = document.getElementById("statusA").value;
			xhr.open("GET", "./OV/main/status/A");
			xhr.send();
		}

		function statusFilterI() {
			let status = document.getElementById("statusI").value;
			xhr.open("GET", "./OV/main/status/I");
			xhr.send();
		}

		function statusFilterH() {
			let status = document.getElementById("statusH").value;
			xhr.open("GET", "./OV/main/status/H");
			xhr.send();
		}

		function getId(x, name) {
			xhr.open("GET", "./OV/main/employees/" + x);
			xhr.send(this.responseText);
			var infoname = document.getElementById("infotitle");
			infoname.innerHTML = name;
			var body = document.getElementById('infotable');
			body.innerHTML = "";
			$("#empInfo").modal();
		}

		$(function() {

			$("#officeDropdown a").click(function() {

				$("#officeButtton").text($(this).text());
				$("#officeButtton").val($(this).text());

			});

			$("#statusDropdown a").click(function() {

				$("#statusButton").text($(this).text());
				$("#statusButton").val($(this).text());

			});

		});

		function requestContent() {
			xhr.open("GET", "./OV/test");
			xhr.send();
			window.setTimeout(requestContent2, 100);
		}

		function requestContent2() {
			xhr.open("GET", "./OV/main/employees");
			xhr.send();
			window.setTimeout(requestContent3, 100);
		}

		function requestContent3() {
			xhr.open("GET", "./OV/main/databases");
			xhr.send();
		}
		
		function logout(){
			
		}
	</script>
</body>

</html>